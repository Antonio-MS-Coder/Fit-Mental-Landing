(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,57951,t=>{"use strict";t.s(["AuthProvider",()=>c,"useAuth",()=>n]);var e=t.i(43476),a=t.i(71645);t.i(51718);var r=t.i(18357);t.i(36180);var i=t.i(98925),o=t.i(59141);let u=(0,a.createContext)(null);function n(){let t=(0,a.useContext)(u);if(!t)throw Error("useAuth must be used within an AuthProvider");return t}function c(t){let{children:n}=t,[c,d]=(0,a.useState)(null),[s,l]=(0,a.useState)(null),[h,w]=(0,a.useState)(!0),[y,A]=(0,a.useState)(!1),f=async t=>{try{let r=(0,i.doc)(o.db,"users",t),u=await (0,i.getDoc)(r);if(u.exists()){var e,a;let t=u.data();l({...t,createdAt:null==(e=t.createdAt)?void 0:e.toDate(),updatedAt:null==(a=t.updatedAt)?void 0:a.toDate()}),A(!1)}else A(!0),l(null)}catch(t){console.error("Error loading user profile:",t)}},p=async(t,e)=>{w(!0);try{await (0,r.signInWithEmailAndPassword)(o.auth,t,e)}catch(t){throw w(!1),t}},m=async()=>{w(!0);try{let t=new r.GoogleAuthProvider;await (0,r.signInWithPopup)(o.auth,t)}catch(t){throw w(!1),t}},v=async function(t,e,a,u){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};w(!0);try{let{user:c}=await (0,r.createUserWithEmailAndPassword)(o.auth,t,e);await (0,r.updateProfile)(c,{displayName:a});let d={uid:c.uid,email:t,displayName:a,role:u,createdAt:new Date,updatedAt:new Date,...n};await (0,i.setDoc)((0,i.doc)(o.db,"users",c.uid),d),l(d),A(!1)}catch(t){throw w(!1),t}},D=async(t,e)=>{w(!0);try{let a=await (0,r.signInWithPhoneNumber)(o.auth,t,e);return w(!1),a}catch(t){throw w(!1),t}},g=async(t,e)=>{w(!0);try{await t.confirm(e)}catch(t){throw w(!1),t}},P=async function(t,e,a){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(c){w(!0);try{await (0,r.updateProfile)(c,{displayName:e});let n={uid:c.uid,email:c.email||"",displayName:e,role:a,phone:t,createdAt:new Date,updatedAt:new Date,...u};await (0,i.setDoc)((0,i.doc)(o.db,"users",c.uid),n),l(n),A(!1)}catch(t){throw w(!1),t}}},b=async t=>{if(c){w(!0);try{let e={uid:c.uid,email:c.email,displayName:c.displayName||"Usuario",role:t,createdAt:new Date,updatedAt:new Date};await (0,i.setDoc)((0,i.doc)(o.db,"users",c.uid),e),l(e),A(!1)}catch(t){throw t}finally{w(!1)}}},S=async()=>{try{await (0,r.signOut)(o.auth),l(null),A(!1)}catch(t){throw t}},C=async t=>{if(c&&s)try{let e={...s,...t,updatedAt:new Date};await (0,i.setDoc)((0,i.doc)(o.db,"users",c.uid),e,{merge:!0}),l(e)}catch(t){throw t}};return(0,a.useEffect)(()=>(0,r.onAuthStateChanged)(o.auth,async t=>{d(t),t?await f(t.uid):(l(null),A(!1)),w(!1)}),[]),(0,e.jsx)(u.Provider,{value:{user:c,userProfile:s,loading:h,needsRoleSelection:y,signIn:p,signInWithGoogle:m,signInWithPhone:D,verifyPhoneCode:g,signUpWithPhone:P,signUp:v,selectUserRole:b,logout:S,updateUserProfile:C},children:n})}}]);